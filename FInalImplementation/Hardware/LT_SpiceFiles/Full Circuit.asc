Version 4
SHEET 1 6628 1644
WIRE 1104 -304 736 -304
WIRE 2240 -304 1104 -304
WIRE 2720 -304 2720 -336
WIRE 2720 -304 2240 -304
WIRE 3104 -304 2720 -304
WIRE 256 -176 -16 -176
WIRE 1488 -176 256 -176
WIRE 3504 -176 1488 -176
WIRE 256 -144 256 -176
WIRE 256 0 256 -64
WIRE -16 16 -16 -176
WIRE 5712 16 5696 16
WIRE 5824 16 5792 16
WIRE 5856 16 5824 16
WIRE 6192 16 6112 16
WIRE 6352 16 6192 16
WIRE 6432 16 6352 16
WIRE 1104 32 1104 -304
WIRE 1072 48 1056 48
WIRE 1200 64 1136 64
WIRE 576 80 560 80
WIRE 688 80 656 80
WIRE 1072 80 880 80
WIRE 1488 80 1488 -176
WIRE 2064 80 2048 80
WIRE 2176 80 2144 80
WIRE 3072 80 2704 80
WIRE 4768 80 4640 80
WIRE 5040 80 4768 80
WIRE 4768 96 4768 80
WIRE 5184 96 4896 96
WIRE 448 144 400 144
WIRE 560 144 560 80
WIRE 560 144 528 144
WIRE 736 144 736 -304
WIRE 736 144 624 144
WIRE 1936 144 1776 144
WIRE 2048 144 2048 80
WIRE 2048 144 2016 144
WIRE 2240 144 2240 -304
WIRE 2240 144 2112 144
WIRE 560 160 560 144
WIRE 592 160 560 160
WIRE 2048 160 2048 144
WIRE 2080 160 2048 160
WIRE 5040 160 5040 80
WIRE 688 176 688 80
WIRE 688 176 656 176
WIRE 752 176 688 176
WIRE 880 176 880 80
WIRE 880 176 832 176
WIRE 944 176 880 176
WIRE 2176 176 2176 80
WIRE 2176 176 2144 176
WIRE 2576 176 2176 176
WIRE 4896 176 4896 96
WIRE 5008 176 4896 176
WIRE 592 192 560 192
WIRE 2080 192 2048 192
WIRE 5184 192 5184 96
WIRE 5184 192 5072 192
WIRE 5248 192 5184 192
WIRE 256 208 256 80
WIRE 384 208 256 208
WIRE 448 208 384 208
WIRE 560 208 560 192
WIRE 560 208 528 208
WIRE 880 208 880 176
WIRE 1488 208 1488 160
WIRE 1648 208 1488 208
WIRE 1936 208 1648 208
WIRE 2048 208 2048 192
WIRE 2048 208 2016 208
WIRE 4768 208 4768 176
WIRE 5008 208 4768 208
WIRE 560 224 560 208
WIRE 624 224 624 208
WIRE 640 224 624 224
WIRE 2048 224 2048 208
WIRE 2112 240 2112 208
WIRE 2144 240 2112 240
WIRE 4768 240 4768 208
WIRE 5792 240 5792 16
WIRE 6192 240 6192 16
WIRE 6352 240 6352 16
WIRE 1488 256 1488 208
WIRE 1648 256 1648 208
WIRE 384 272 384 208
WIRE 1648 352 1648 320
WIRE 4768 352 4768 320
WIRE 256 368 256 208
WIRE 256 368 224 368
WIRE 288 368 256 368
WIRE 384 368 384 336
WIRE 560 384 560 304
WIRE 1056 384 1056 48
WIRE 1056 384 560 384
WIRE 2048 384 2048 304
WIRE 2048 384 1056 384
WIRE 3056 384 2048 384
WIRE 5792 416 5792 304
WIRE 5984 416 5984 112
WIRE 5984 416 5792 416
WIRE 6080 416 5984 416
WIRE 6192 416 6192 304
WIRE 6192 416 6080 416
WIRE 6352 416 6352 320
WIRE 6352 416 6192 416
WIRE 256 448 224 448
WIRE 288 448 256 448
WIRE -16 480 -16 96
WIRE 256 480 256 448
WIRE 256 480 -16 480
WIRE 384 480 384 432
WIRE 384 480 256 480
WIRE 400 480 400 144
WIRE 400 480 384 480
WIRE 640 480 640 224
WIRE 640 480 400 480
WIRE 880 480 880 272
WIRE 880 480 640 480
WIRE 1104 480 1104 96
WIRE 1104 480 880 480
WIRE 1488 480 1488 336
WIRE 1488 480 1104 480
WIRE 1648 480 1648 416
WIRE 1648 480 1488 480
WIRE 1776 480 1776 144
WIRE 1776 480 1648 480
WIRE 2144 480 2144 240
WIRE 2144 480 1776 480
WIRE 3104 480 2144 480
WIRE 4768 480 4768 432
WIRE 4912 560 4768 560
WIRE 5040 560 5040 224
WIRE 5040 560 4912 560
WIRE 4576 960 4576 864
WIRE 4576 960 4528 960
WIRE 4640 960 4576 960
WIRE 4576 992 4576 960
WIRE 1712 1152 1408 1152
WIRE 2400 1152 2096 1152
WIRE 1472 1232 1472 1200
WIRE 2160 1232 2160 1200
WIRE 1408 1248 1408 1152
WIRE 1440 1248 1408 1248
WIRE 2096 1248 2096 1152
WIRE 2128 1248 2096 1248
WIRE 1616 1264 1504 1264
WIRE 1712 1264 1712 1152
WIRE 1712 1264 1680 1264
WIRE 1760 1264 1712 1264
WIRE 1872 1264 1760 1264
WIRE 2304 1264 2192 1264
WIRE 2400 1264 2400 1152
WIRE 2400 1264 2368 1264
WIRE 2448 1264 2400 1264
WIRE 2560 1264 2448 1264
WIRE 4576 1264 4576 1056
WIRE 6064 1264 6048 1264
WIRE 1440 1280 1392 1280
WIRE 2128 1280 2080 1280
WIRE 6192 1280 6128 1280
WIRE 1872 1296 1872 1264
WIRE 2560 1296 2560 1264
WIRE 6064 1296 6048 1296
WIRE 1760 1312 1760 1264
WIRE 2448 1312 2448 1264
WIRE 1472 1408 1472 1296
WIRE 1760 1408 1760 1376
WIRE 1760 1408 1472 1408
WIRE 1872 1408 1872 1376
WIRE 1872 1408 1760 1408
WIRE 2160 1408 2160 1296
WIRE 2448 1408 2448 1376
WIRE 2448 1408 2160 1408
WIRE 2560 1408 2560 1376
WIRE 2560 1408 2448 1408
WIRE 1760 1440 1760 1408
WIRE 2448 1440 2448 1408
FLAG 5824 16 Vin
FLAG 944 176 Vcurrent
FLAG 4640 960 Vvoltage
FLAG 1200 64 Vicomparator
FLAG 6192 1280 Vvcomparator
FLAG 1392 1280 Vcurrent
FLAG 2720 -336 5_Volt_Line
FLAG 1472 1200 5_Volt_Line
FLAG 1760 1440 0
FLAG 2080 1280 Vvoltage
FLAG 2160 1200 5_Volt_Line
FLAG 2448 1440 0
FLAG 6432 16 5_Volt_Line
FLAG 5632 16 Vac
FLAG 5248 192 2.1_Volt_Line
FLAG 4640 80 5_Volt_Line
FLAG 6080 416 0
FLAG 4912 560 0
FLAG 6096 1312 0
FLAG 6096 1248 5_Volt_Line
FLAG 6048 1264 2.1_Volt_Line
FLAG 6048 1296 Vvoltage
SYMBOL ind 240 -160 R0
SYMATTR InstName L1
SYMATTR Value 40mH
SYMBOL res 240 -16 R0
SYMATTR InstName R1
SYMATTR Value 17.034
SYMBOL voltage -16 0 R0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vac
SYMATTR Value SINE(0 17.81909089 50)
SYMATTR Value2 AC 19.79898987
SYMBOL res 1472 64 R0
SYMATTR InstName R3
SYMATTR Value 820k
SYMBOL res 1472 240 R0
SYMATTR InstName R4
SYMATTR Value 39k
SYMBOL PowerProducts/LT1085-5 5984 16 R0
SYMATTR InstName Reg1
SYMBOL res 5808 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rin1
SYMATTR Value 33
SYMBOL diode 5632 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL cap 5776 240 R0
SYMATTR InstName Cin1
SYMATTR Value 470µ
SYMATTR SpiceLine Rser=0.001
SYMBOL cap 6176 240 R0
SYMATTR InstName Cout1
SYMATTR Value 47µ
SYMATTR SpiceLine Rser=0.001
SYMBOL Opamps/opamp2 5040 128 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U3
SYMATTR Value LM324
SYMBOL res 4752 80 R0
SYMATTR InstName R8
SYMATTR Value 39k
SYMBOL res 4752 224 R0
SYMATTR InstName R9
SYMATTR Value 27k
SYMBOL res 4752 464 R0
SYMATTR InstName R11
SYMATTR Value 39
SYMBOL res 4752 336 R0
SYMATTR InstName R10
SYMATTR Value 1.2k
SYMBOL Opamps/opamp2 624 112 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U4
SYMATTR Value LM324
SYMBOL res 544 192 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R12
SYMATTR Value 3.9k
SYMBOL res 544 128 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R13
SYMATTR Value 3.9k
SYMBOL res 672 64 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -31 62 VTop 2
SYMATTR InstName R14
SYMATTR Value 8.2k
SYMBOL res 576 320 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R15
SYMATTR Value 8.2k
SYMBOL res 848 160 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName Rf2
SYMATTR Value 10k
SYMBOL cap 896 272 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf2
SYMATTR Value 33n
SYMBOL Opamps/opamp2 2112 112 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U1
SYMATTR Value LM324
SYMBOL res 2032 192 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R6
SYMATTR Value 18k
SYMBOL res 2032 128 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R16
SYMATTR Value 56k
SYMBOL res 2160 64 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -31 62 VTop 2
SYMATTR InstName R17
SYMATTR Value 56k
SYMBOL res 2064 320 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R18
SYMATTR Value 56k
SYMBOL res 4544 944 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName Rf3
SYMATTR Value 10k
SYMBOL cap 4592 1056 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf3
SYMATTR Value 33n
SYMBOL res 6336 224 R0
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL Opamps/opamp2 1104 0 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U2
SYMATTR Value LM324
SYMBOL Opamps/opamp2 6096 1216 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U5
SYMATTR Value LM324
SYMBOL res 272 352 R0
SYMATTR InstName R2
SYMATTR Value 1.2
SYMBOL res 208 352 R0
SYMATTR InstName R7
SYMATTR Value 1
SYMBOL Opamps/opamp2 1472 1200 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U6
SYMATTR Value LM324
SYMBOL cap 1776 1376 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf1
SYMATTR Value 1000n
SYMBOL res 1856 1280 R0
SYMATTR InstName R19
SYMATTR Value 10000k
SYMBOL diode 1616 1280 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL Opamps/opamp2 2160 1200 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U7
SYMATTR Value LM324
SYMBOL cap 2464 1376 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf4
SYMATTR Value 1m
SYMBOL res 2544 1280 R0
SYMATTR InstName R20
SYMATTR Value 35k
SYMBOL diode 2304 1280 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL zener 1632 352 R0
SYMATTR InstName D4
SYMBOL zener 1664 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL zener 368 368 R0
SYMATTR InstName D6
SYMBOL zener 400 336 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
TEXT -112 928 Left 2 ;.ac dec 30 1 1Meg
TEXT -112 864 Left 2 !.lib LM324.lib
TEXT -120 800 Left 2 ;Simulation Commands\n- Change these as needed
TEXT -112 896 Left 2 !.tran 0 1 0 0.1m
TEXT -112 960 Left 2 !.ic V(Vin)=8
TEXT 1424 24 Left 2 ;Load Voltage Stepdown Divider
TEXT 1496 48 Left 2 ;G = 45.402*10^-3
TEXT 1912 -32 Left 2 ;Load Voltage DC Offset OpAmp
TEXT 1912 512 Left 2 ;G = 1
TEXT 1912 544 Left 2 ;DC Offset added : 2.1 Volts
TEXT 1912 576 Left 2 ;Note: R16 = R17 = R18
TEXT 1936 600 Left 2 ;= (R6 + Rthevenin) for G = 1.
TEXT 4368 832 Left 2 ;Load Voltage 1st Order Filter Circuit
TEXT 4384 1296 Left 2 ;Cutoff Frequency: 1KHz
TEXT 2432 -320 Left 3 ;5 Volt Line
TEXT 4784 8 Left 2 ;OpAmp Voltage Follower DC Offset
TEXT 4688 632 Left 2 ;Voltage divider DC offset created: 2.1 Volts
TEXT 4696 672 Left 2 ;Voltage follower: G = 1
TEXT 424 536 Left 2 ;Load Current (represented by Voltage) DC offset opamp
TEXT -104 568 Left 2 ;Shunt resistor for voltage divider
TEXT -144 592 Left 2 ;Voltage across R2 used to measure current
TEXT 744 56 Left 2 ;Cutoff Frequency: 1KHz
TEXT 736 16 Left 2 ;Load Current 1st Order Filter Circuit
TEXT 424 560 Left 2 ;DC offset of 2.1 Added
TEXT 424 584 Left 2 ;G = 2.1
TEXT -136 624 Left 2 ;G = variable depending on R1
TEXT -584 104 Left 2 ;Source voltage varies from 12.6 to 15.4 V RMS
TEXT 280 -40 Left 2 ;RLoad (R1) varies from 17.034 to 94.86 ohms
TEXT 1624 880 Left 2 ;IMPROVED ZERO CROSSING DETECTOR - NEED TO FIND VALUES
TEXT 2368 -824 Left 2 ;Line
TEXT 6000 -168 Left 2 ;Linear Regulator
TEXT 5952 1040 Left 2 ;Voltage Zero Crossing Detector
LINE Normal 720 -16 368 -16 1
LINE Normal 720 512 720 -16 1
LINE Normal 384 512 720 512 1
LINE Normal 368 512 368 -16 1
LINE Normal 384 512 368 512 1
LINE Normal 336 176 160 176 1
LINE Normal 336 544 336 176 1
LINE Normal 144 544 336 544 1
LINE Normal 144 176 144 544 1
LINE Normal 160 176 144 176 1
LINE Normal 992 16 768 16 1
LINE Normal 992 448 992 16 1
LINE Normal 768 448 992 448 1
LINE Normal 768 16 768 448 1
LINE Normal 80 -32 -96 -32 1
LINE Normal 80 192 80 -32 1
LINE Normal -96 192 80 192 1
LINE Normal -96 -32 -96 192 1
LINE Normal 208 80 208 -64 1
LINE Normal 352 80 208 80 1
LINE Normal 352 -64 352 80 1
LINE Normal 208 -64 352 -64 1
LINE Normal 2384 880 2384 -816 2
RECTANGLE Normal -152 784 284 988 2
RECTANGLE Normal 1728 368 1456 64 1
RECTANGLE Normal 2288 656 1888 -16 1
RECTANGLE Normal 4784 1344 4368 848 1
RECTANGLE Normal 2688 1632 1216 912 2
RECTANGLE Normal 6608 512 5552 -144 2
RECTANGLE Normal 5456 736 4480 48 2
RECTANGLE Normal 6384 1408 5840 1072 2
