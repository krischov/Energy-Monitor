Version 4
SHEET 1 6628 2468
WIRE -416 -256 -416 -288
WIRE -416 -112 -416 -176
WIRE -416 16 -416 -32
WIRE -272 16 -416 16
WIRE 5712 16 5696 16
WIRE 5824 16 5792 16
WIRE 5856 16 5824 16
WIRE 6192 16 6112 16
WIRE 6352 16 6192 16
WIRE 6432 16 6352 16
WIRE -416 80 -416 16
WIRE -416 80 -448 80
WIRE -384 80 -416 80
WIRE 4768 80 4640 80
WIRE 5040 80 4768 80
WIRE 4768 96 4768 80
WIRE 5184 96 4896 96
WIRE -416 160 -448 160
WIRE -384 160 -416 160
WIRE 5040 160 5040 80
WIRE 4896 176 4896 96
WIRE 5008 176 4896 176
WIRE -416 192 -416 160
WIRE 5184 192 5184 96
WIRE 5184 192 5072 192
WIRE 5248 192 5184 192
WIRE 4768 208 4768 176
WIRE 5008 208 4768 208
WIRE 4768 240 4768 208
WIRE 5792 240 5792 16
WIRE 6192 240 6192 16
WIRE 6352 240 6352 16
WIRE 4768 352 4768 320
WIRE 5792 416 5792 304
WIRE 5984 416 5984 112
WIRE 5984 416 5792 416
WIRE 6080 416 5984 416
WIRE 6192 416 6192 304
WIRE 6192 416 6080 416
WIRE 6352 416 6352 320
WIRE 6352 416 6192 416
WIRE 4768 480 4768 432
WIRE -1712 528 -1728 528
WIRE -1600 528 -1632 528
WIRE 4912 560 4768 560
WIRE 5040 560 5040 224
WIRE 5040 560 4912 560
WIRE -1840 592 -1888 592
WIRE -1728 592 -1728 528
WIRE -1728 592 -1760 592
WIRE -1552 592 -1664 592
WIRE -1728 608 -1728 592
WIRE -1696 608 -1728 608
WIRE -1600 624 -1600 528
WIRE -1600 624 -1632 624
WIRE -1536 624 -1600 624
WIRE -1168 624 -1184 624
WIRE -1040 624 -1040 592
WIRE -1040 624 -1088 624
WIRE -976 624 -1040 624
WIRE -496 624 -512 624
WIRE -1696 640 -1728 640
WIRE -368 640 -432 640
WIRE -1904 656 -1968 656
WIRE -1840 656 -1904 656
WIRE -1728 656 -1728 640
WIRE -1728 656 -1760 656
WIRE -1040 656 -1040 624
WIRE -496 656 -512 656
WIRE -1728 672 -1728 656
WIRE -1904 720 -1904 656
WIRE -1904 816 -1904 784
WIRE -1904 928 -1904 880
WIRE 4576 960 4576 864
WIRE 4576 960 4528 960
WIRE 4640 960 4576 960
WIRE 4576 992 4576 960
WIRE 1712 1152 1408 1152
WIRE 2400 1152 2096 1152
WIRE 1472 1232 1472 1200
WIRE 2160 1232 2160 1200
WIRE 1408 1248 1408 1152
WIRE 1440 1248 1408 1248
WIRE 2096 1248 2096 1152
WIRE 2128 1248 2096 1248
WIRE 1616 1264 1504 1264
WIRE 1712 1264 1712 1152
WIRE 1712 1264 1680 1264
WIRE 1760 1264 1712 1264
WIRE 1872 1264 1760 1264
WIRE 2304 1264 2192 1264
WIRE 2400 1264 2400 1152
WIRE 2400 1264 2368 1264
WIRE 2448 1264 2400 1264
WIRE 2560 1264 2448 1264
WIRE 4576 1264 4576 1056
WIRE 6064 1264 6048 1264
WIRE 1440 1280 1392 1280
WIRE 2128 1280 2080 1280
WIRE 6192 1280 6128 1280
WIRE 1872 1296 1872 1264
WIRE 2560 1296 2560 1264
WIRE 6064 1296 6048 1296
WIRE 1760 1312 1760 1264
WIRE 2448 1312 2448 1264
WIRE 1472 1408 1472 1296
WIRE 1760 1408 1760 1376
WIRE 1760 1408 1472 1408
WIRE 1872 1408 1872 1376
WIRE 1872 1408 1760 1408
WIRE 2160 1408 2160 1296
WIRE 2448 1408 2448 1376
WIRE 2448 1408 2160 1408
WIRE 2560 1408 2560 1376
WIRE 2560 1408 2448 1408
WIRE -1120 1440 -1136 1440
WIRE -1008 1440 -1040 1440
WIRE 1760 1440 1760 1408
WIRE 2448 1440 2448 1408
WIRE -1136 1504 -1136 1440
WIRE -1136 1504 -1168 1504
WIRE -944 1504 -1072 1504
WIRE -1136 1520 -1136 1504
WIRE -1104 1520 -1136 1520
WIRE -1008 1536 -1008 1440
WIRE -1008 1536 -1040 1536
WIRE -816 1536 -1008 1536
WIRE -1104 1552 -1136 1552
WIRE -1760 1568 -1760 1520
WIRE -1600 1568 -1760 1568
WIRE -1504 1568 -1600 1568
WIRE -1136 1568 -1136 1552
WIRE -1136 1568 -1168 1568
WIRE -1136 1584 -1136 1568
WIRE -1760 1616 -1760 1568
WIRE -1600 1616 -1600 1568
WIRE -1136 1696 -1136 1664
WIRE -1600 1712 -1600 1680
FLAG 5824 16 Vin
FLAG -976 624 Vcurrent
FLAG 4640 960 Vvoltage
FLAG -368 640 Vicomparator
FLAG 6192 1280 Vvcomparator
FLAG 1392 1280 Vcurrent
FLAG 1472 1200 5_Volt_Line
FLAG 1760 1440 0
FLAG 2080 1280 Vvoltage
FLAG 2160 1200 5_Volt_Line
FLAG 2448 1440 0
FLAG 6432 16 5_Volt_Line
FLAG 5632 16 Vac
FLAG 5248 192 2.1_Volt_Line
FLAG 4640 80 5_Volt_Line
FLAG 6080 416 0
FLAG 4912 560 0
FLAG 6096 1312 0
FLAG 6096 1248 5_Volt_Line
FLAG 6048 1264 2.1_Volt_Line
FLAG 6048 1296 Vvoltage
FLAG -1600 -64 0
FLAG -1600 -144 Vac
FLAG -416 -288 Vac
FLAG -416 192 0
FLAG -272 16 V_is
FLAG -1664 656 0
FLAG -464 672 0
FLAG -1888 592 0
FLAG -1904 928 0
FLAG -1040 720 0
FLAG -1968 656 V_is
FLAG -464 608 5_Volt_Line
FLAG -1552 592 5_Volt_Line
FLAG -944 1504 5_Volt_Line
FLAG -1136 1696 2.1_Volt_Line
FLAG -1072 1568 0
FLAG -1248 1504 0
FLAG -1760 1696 0
FLAG -1600 1776 0
FLAG -1728 752 2.1_Volt_Line
FLAG -512 624 2.1_Volt_Line
FLAG -1760 1440 Vac
FLAG -1504 1568 Vvs
FLAG -1248 1568 Vvs
FLAG -1536 624 Vis_unfiltered
FLAG -1184 624 Vis_unfiltered
FLAG -512 656 V_is_filtered
FLAG -1040 592 V_is_filtered
SYMBOL ind -432 -272 R0
SYMATTR InstName L1
SYMATTR Value 40mH
SYMBOL res -432 -128 R0
SYMATTR InstName R1
SYMATTR Value 17.034
SYMBOL voltage -1600 -160 R0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vac
SYMATTR Value SINE(0 17.81909089 50)
SYMATTR Value2 AC 19.79898987
SYMBOL res -1776 1424 R0
SYMATTR InstName R3
SYMATTR Value 820k
SYMBOL res -1776 1600 R0
SYMATTR InstName R4
SYMATTR Value 39k
SYMBOL PowerProducts/LT1085-5 5984 16 R0
SYMATTR InstName Reg1
SYMBOL res 5808 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rin1
SYMATTR Value 33
SYMBOL diode 5632 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL cap 5776 240 R0
SYMATTR InstName Cin1
SYMATTR Value 470µ
SYMATTR SpiceLine Rser=0.001
SYMBOL cap 6176 240 R0
SYMATTR InstName Cout1
SYMATTR Value 47µ
SYMATTR SpiceLine Rser=0.001
SYMBOL Opamps/opamp2 5040 128 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U3
SYMATTR Value LM324
SYMBOL res 4752 80 R0
SYMATTR InstName R8
SYMATTR Value 39k
SYMBOL res 4752 224 R0
SYMATTR InstName R9
SYMATTR Value 27k
SYMBOL res 4752 464 R0
SYMATTR InstName R11
SYMATTR Value 39
SYMBOL res 4752 336 R0
SYMATTR InstName R10
SYMATTR Value 1.2k
SYMBOL Opamps/opamp2 -1664 560 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U4
SYMATTR Value LM324
SYMBOL res -1744 640 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R12
SYMATTR Value 3.9k
SYMBOL res -1744 576 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R13
SYMATTR Value 3.9k
SYMBOL res -1616 512 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -31 62 VTop 2
SYMATTR InstName R14
SYMATTR Value 8.2k
SYMBOL res -1712 768 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R15
SYMATTR Value 8.2k
SYMBOL res -1072 608 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName Rf2
SYMATTR Value 10k
SYMBOL cap -1024 720 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf2
SYMATTR Value 33n
SYMBOL Opamps/opamp2 -1072 1472 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U1
SYMATTR Value LM324
SYMBOL res -1152 1552 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R6
SYMATTR Value 18k
SYMBOL res -1152 1488 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R16
SYMATTR Value 56k
SYMBOL res -1024 1424 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -31 62 VTop 2
SYMATTR InstName R17
SYMATTR Value 56k
SYMBOL res -1120 1680 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R18
SYMATTR Value 56k
SYMBOL res 4544 944 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName Rf3
SYMATTR Value 10k
SYMBOL cap 4592 1056 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf3
SYMATTR Value 33n
SYMBOL res 6336 224 R0
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL Opamps/opamp2 -464 576 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U2
SYMATTR Value LM324
SYMBOL Opamps/opamp2 6096 1216 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U5
SYMATTR Value LM324
SYMBOL res -400 64 R0
SYMATTR InstName R2
SYMATTR Value 1.2
SYMBOL res -464 64 R0
SYMATTR InstName R7
SYMATTR Value 1
SYMBOL Opamps/opamp2 1472 1200 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U6
SYMATTR Value LM324
SYMBOL cap 1776 1376 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf1
SYMATTR Value 1000n
SYMBOL res 1856 1280 R0
SYMATTR InstName R19
SYMATTR Value 10000k
SYMBOL diode 1616 1280 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL Opamps/opamp2 2160 1200 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U7
SYMATTR Value LM324
SYMBOL cap 2464 1376 R180
WINDOW 0 29 13 Left 2
WINDOW 3 33 -11 Left 2
SYMATTR InstName Cf4
SYMATTR Value 1m
SYMBOL res 2544 1280 R0
SYMATTR InstName R20
SYMATTR Value 35k
SYMBOL diode 2304 1280 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL zener -1616 1712 R0
SYMATTR InstName D4
SYMBOL zener -1584 1680 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL zener -1920 816 R0
SYMATTR InstName D6
SYMBOL zener -1888 784 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
TEXT 1264 1872 Left 2 ;.ac dec 30 1 1Meg
TEXT 1264 1808 Left 2 !.lib LM324.lib
TEXT 1256 1744 Left 2 ;Simulation Commands\n- Change these as needed
TEXT 1264 1840 Left 2 !.tran 0 1 0 0.1m
TEXT 1264 1904 Left 2 !.ic V(Vin)=8
TEXT -1824 1384 Left 2 ;Load Voltage Stepdown Divider
TEXT -1752 1408 Left 2 ;G = 45.402*10^-3
TEXT -1272 1328 Left 2 ;Load Voltage DC Offset OpAmp
TEXT -1272 1872 Left 2 ;G = 1
TEXT -1272 1904 Left 2 ;DC Offset added : 2.1 Volts
TEXT -1272 1936 Left 2 ;Note: R16 = R17 = R18
TEXT -1248 1960 Left 2 ;= (R6 + Rthevenin) for G = 1.
TEXT 4368 832 Left 2 ;Load Voltage 1st Order Filter Circuit
TEXT 4384 1296 Left 2 ;Cutoff Frequency: 1KHz
TEXT 4784 8 Left 2 ;OpAmp Voltage Follower DC Offset
TEXT 4688 632 Left 2 ;Voltage divider DC offset created: 2.1 Volts
TEXT 4696 672 Left 2 ;Voltage follower: G = 1
TEXT -1984 1040 Left 2 ;Load Current (represented by Voltage) DC offset opamp
TEXT -1056 -24 Left 2 ;Shunt resistor for voltage divider
TEXT -1096 0 Left 2 ;Voltage across R2 used to measure current
TEXT -1264 464 Left 2 ;Cutoff Frequency: 1KHz
TEXT -1280 440 Left 2 ;Load Current 1st Order Filter Circuit
TEXT -1984 1064 Left 2 ;DC offset of 2.1 Added
TEXT -1984 1088 Left 2 ;G = 2.1
TEXT -1088 32 Left 2 ;G = variable depending on R1
TEXT -2168 -56 Left 2 ;Source voltage varies from 12.6 to 15.4 V RMS
TEXT -640 -384 Left 2 ;RLoad (R1) varies from 17.034 to 94.86 ohms
TEXT 1624 880 Left 2 ;IMPROVED ZERO CROSSING DETECTOR - NEED TO FIND VALUES
TEXT 6000 -168 Left 2 ;Linear Regulator
TEXT 5952 1040 Left 2 ;Voltage Zero Crossing Detector
LINE Normal -928 464 -1152 464 1
LINE Normal -928 896 -928 464 1
LINE Normal -1152 896 -928 896 1
LINE Normal -1152 464 -1152 896 1
LINE Normal -1504 -192 -1680 -192 1
LINE Normal -1504 32 -1504 -192 1
LINE Normal -1680 32 -1504 32 1
LINE Normal -1680 -192 -1680 32 1
RECTANGLE Normal 1224 1728 1660 1932 2
RECTANGLE Normal -1520 1728 -1792 1424 1
RECTANGLE Normal -896 2016 -1296 1344 1
RECTANGLE Normal 4784 1344 4368 848 1
RECTANGLE Normal 2688 1632 1216 912 2
RECTANGLE Normal 6608 512 5552 -144 2
RECTANGLE Normal 5456 736 4480 48 2
RECTANGLE Normal 6384 1408 5840 1072 2
RECTANGLE Normal -288 -16 -512 -352 1
RECTANGLE Normal -288 224 -512 48 1
